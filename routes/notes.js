var express = require('express');
var router = express.Router();

const fs = require('fs');
let NeDB = require('nedb');
let db = new NeDB({
    filename: 'notes.db',
    autoload: true
})



router.get('/', (req, res) => {
  db.find({}).sort({name:1}).exec((err, note) => {

    if(err) {
      console.error(err);
        
    } else {
        res.statusCode = 200;
        res.setHeader('Content-Type', 'application/json');
        res.json({
            note
        });
    }
});
  
}); 

router.post('/', (req, res) => {
  
  db.insert(req.body, (err, note) =>
           
  {
      if (err) {
          console.error(err);
      } else {
        res.status(200).json(note);
      }
  })
  
  
});


router.get('/:category', (req, res) => {

  db.find({category:req.params.category}).exec((err, note) => {
      if(err) {
        console.error(err);
      } else {
          res.status(200).json(note);
      }
  });
})

router.put('/:id', (req, res) => {

  db.update({_id:req.params.id}, req.body, err => {
      if(err) {
           console.error(err);
      } else {
          res.status(200).json(Object.assign(req.params, req.body));
      }
  });
});

router.delete('/:id', (req, res) => {

  db.remove({_id:req.params.id}, {}, err=> {

    if(err) {
      console.error(err);
    } else {
        res.status(200).json(req.params);
    }
   });
});




module.exports = router;
