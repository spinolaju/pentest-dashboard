var express = require('express');
var router = express.Router();

let NeDB = require('nedb');


let db = new NeDB({
    filename: 'projects.db',
    autoload: true
})


router.get('/', (req, res) => {
  db.find({}).sort({name:1}).exec((err, project) => {

    if(err) {
      console.error(err);
        
    } else {
        res.statusCode = 200;
        res.setHeader('Content-Type', 'application/json');
        res.json({
            project
        });
    }
});
  
}); 

router.post('/', (req, res) => {
  
  db.insert(req.body, (err, project) =>
           
  {
      if (err) {
          console.error(err);
      } else {
        res.status(200).json(project);
      }
  })
  
  
});


router.get('/:projID', (req, res) => {

  db.find({projID:req.params.projID}).exec((err, project) => {
      if(err) {
        console.error(err);
      } else {
          res.status(200).json(project);
      }
  });
})


router.put('/:projID', (req, res) => {

  db.update({projID:req.params.projID}, req.body, err => {
      if(err) {
           console.error(err);
      } else {
          res.status(200).json(Object.assign(req.params, req.body));
      }
  });
});



router.delete('/:id', (req, res) => {

  db.remove({_id:req.params.id}, {}, err=> {

    if(err) {
      console.error(err);
    } else {
        res.status(200).json(req.params);
    }
   });
});




module.exports = router;
